# Minimalistic Microservice Framework

This documentation is written along the guidelines of educational grade documentation discussed in the 
[infracamp](https://github.com/infracamp/infracamp/blob/master/DOCUMENTATION_GUIDE.md) project. Please ask and
document issues.

## Goals

- Minimal Footprint
- No external dependencies
- Clear and small stack trace
- Fluent Api
- Role-Based Authentication

## Quickstart

```index.php:```
```php
$app = new App();
$app->acl->addRule(aclRule()->ALLOW());                     // Allow all requests

$app->router
    ->get("/",                                              // Define a Action for HTTP-GET-Requests to /
        function() use ($app) {                             
            $app->out("Hello World");                       // Hello World!
        }
    );
    
$app->serve();                                              // Run the App
```

## Installation

We suggest using [composer](http://getcomposer.com):

```
composer require phore/micro-app
``` 

## [ACL (Access Control Lists / Firewall)](doc/acl/acl.md) *([Example](doc/acl/acl.php), [FAQ](doc/acl/acl-faq.md))*


***Access Control Lists*** define which User/IP may access which route in
your application. It will initiate the Authentication Process (see Authentication)
or reject the request.

ACLs will be processed from top to bottom. The first rule that matches the request
will win.

### Examples

- ***ALLOW*** if route matches `/api/admin/*` ***AND*** role matches `@admin` ***AND*** network matches `10.0.0.0/8`:
    ```php
    $app->acl->addRule(aclRule()->route("/api/admin/*")->role("@admin")->network("10.0.0.0/8")->ALLOW());
    ```

- ***ALLOW*** access to routes `/admin/*` if authenticated user is in `@admin`-group:
    ```php
    $app->acl->addRule(aclRule()->route("/admin/*")->role("@admin")->ALLOW());
    ```


***By default phore-micro-app will deny all requests. So you have to specify explicitly
which requests to allow***

## [Routing](docs/router/routing.md) *([Example](docs/router/routing-example.php))*

Define routes (Path) and connect them to controller functions:

- Execute the function if the browser hits `http://domain.xy/hello/world`:
  ```
  $app->router->get("/hello/world", function() {
      echo "Hello World";
      exit
  });
  ```
  
- Define Parameters (Prefix `:`) and optional parameters (`?`) in Routes:
  ```
  $app->router->get("/api/create/:userId/:userName?", function(RouteParams $routeParams) {
      echo "Hello {$routeParams->get("userId")} - {$routeParams->get("userName", 'Default Username')}";
  });
  ```
  *`$routeParams`* is automaticly generated by Dependency injection.
  
- Delegate a request to a class:
  ```
  $app->router->delegate("/admin/*", AdminController::class);
  ```

Parameters at controller function are generated by Dependency Injection
and may contain any service defined in DiContainer.

Request specific parameters are:

| Parameter Name | ClassName | Description |
|----------------|-----------|-------------|
| `$request`     | `Request` | The full request object |
| `$route`       | `Route`   | The current route object|
| `$routeParams` | `RouteParams` | Container with parameters |
| `$GET`         | `QueryParams` | Query parameters          |
| `$POST`        | `QueryParams` | Parameters send by HTTP-POST |


## Assets *([Example](doc/assets/assets.php))*

Assets are located below the `/asset/`-route. You can define one or
more directories, the asset-manager will try to find the asset.

- Allow all requests to `/asset/*` and link them to local assets:
  ```
  $app->acl->addRule(aclRule()->route("/asset/*")->ALLOW());
  $app->addAssetPath(__DIR__ . "/asset_data/");
  $app->addAssetPath(__DIR__ . "/alt_asset_data/");
  ```
  Request to `/asset/css/some.css`: The asset-manager will try to
  find the file in `/asset_data/css/some.css`. If it does not exist there,
  it will try to find in `/alt_esset_data/css/some.css`
  
- Virtual assets are generated on the fly.
  ```
  $app->addVirtualAsset("all.js", [__DIR__ . "/some/file.js", __DIR__ . "/some/other.js"]);
  ``` 
  The virtual asset is available in path `/asset/all.js`.


## Dependency Injection



## Error Handling

## Authentication & Authorization
